### 强缓存和命中缓存

- 强缓存

  ![image-20210401220401009](F:\github\js_note\network\BroswerCache\image-20210401220401009.png)

  流程：

  1. 游览器先检查查`header` 头中的 `Expire` 和 `Cache-control` 来判断是否满足规则看是否命中强缓存
  2. 命中强缓存，则直接用本地缓存的数据
  3. 没命中的话，则进行服务器的请求
  4. 服务器返回数据
  5. 修改原来的缓存值

- 协商缓存

  ![image-20210401220748897](F:\github\js_note\network\BroswerCache\image-20210401220748897.png)

  1. 将资源标识，比如 `If-Modify-Since` 或 `Etag` 发送到服务器，确认资源是否更新；
  2. 如资源没有改变，则返回304
  3. 游览器则则指使用本地的缓存
  4. 如果资源发生更新，则返回新资源，状态码为200
  5. 修改本地的缓存

- 总流程

  - 看是否命中强缓存，命中即使用本地缓存
  - 看是否命中协商缓存，命中即使用本地缓存
  - 否则，向服务器请求最新资源

用户行为对浏览器缓存的影响

1. 打开网页，地址栏输入地址： 查找 `disk cache` 中是否有匹配。如有则使用；如没有则发送网络请求。
2. 普通刷新 (F5)：因为 TAB 并没有关闭，因此 `memory cache` 是可用的，会被优先使用(如果匹配的话)。其次才是 `disk cache`。
3. 强制刷新 (Ctrl + F5)：浏览器不使用缓存，因此发送的请求头部均带有 `Cache-control:no-cache`(为了兼容，还带了 `Pragma:no-cache`),服务器直接返回 200 和最新内容。

