## XSS知识

#### XSS攻击的介绍

- XSS注入方法
  - 在html内嵌的文本中，恶意内容用script注入
  - 在内联的js中，拼接数据突破了原本的限制
  - 在标签属性中，恶意内容包含引号，从而突破属性值的限制，注入其他属性或者标签。
  - 在href或src等属性中，注入javascript;等可执行代码
  - 在onload，onerror，onclick，注入不受控制代码
  - 在 style 属性和标签中，包含类似 `background-image:url("javascript:...");` 的代码（新版本浏览器已经可以防范）。
  - 在 style 属性和标签中，包含类似 `expression(...)` 的 CSS 表达式代码（新版本浏览器已经可以防范）。

#### XSS攻击的分类

- 什么是XSS
  - Cross-Site-Scripting（跨站脚本攻击）简称XSS，代码注入攻击。
  - 攻击者通过在目标网站上注入恶意脚本，使之在用户的浏览器上运行。利用这些恶意脚本，攻击者可获取用户的敏感信息如 Cookie、SessionID 等，进而危害数据安全。
  - XSS 的本质是：恶意代码未经过滤，与网站正常的代码混在一起；浏览器无法分辨哪些脚本是可信的，导致恶意脚本被执行。
  
- 分类：

  - 存储型XSS

    - 攻击步骤
      - 攻击者将恶意代码提交到目标网站的数据库中。
      - 用户打开目标网站时，网站服务端将恶意代码从数据库取出，拼接在 HTML 中返回给浏览器。
      - 用户浏览器接收到响应后解析执行，混在其中的恶意代码也被执行
      - 恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。

  - 反射性XSS

    - 攻击步骤：
      - 攻击者构造出特殊的 URL，其中包含恶意代码。
      - 用户打开带有恶意代码的 URL 时，网站服务端将恶意代码从 URL 中取出，拼接在 HTML 中返回给浏览器。
      - 用户浏览器接收到响应后解析执行，混在其中的恶意代码也被执行。
      - 恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。

  - DOM型三种

    - 攻击步骤
      - 攻击者构造出特殊的 URL，其中包含恶意代码。
      - 用户打开带有恶意代码的 URL。
      - 用户浏览器接收到响应后解析执行，前端 JavaScript 取出 URL 中的恶意代码并执行。
      - 恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。

    反射型 XSS 跟存储型 XSS 的区别是：存储型 XSS 的恶意代码存在数据库里，反射型 XSS 的恶意代码存在 URL 里。

    DOM 型 XSS 跟前两种 XSS 的区别：DOM 型 XSS 攻击中，取出和执行恶意代码由浏览器端完成，属于前端 JavaScript 自身的安全漏洞，而其他两种 XSS 都属于服务端的安全漏洞

#### XSS攻击的预防和检查

- xss攻击的两大要素

  - 攻击者提交恶意代码
  - 游览器执行恶意代码

- 预防：

  - 输入过滤

    - 防止HTML中出现注入
    - 防止js执行时，执行恶意代码

  - 预防存储型和反射性XSS攻击

    - 纯前端渲染
    - 转义HTML

  - 预防DOM型XSS攻击

    - 用textContent,setAttribute代替innerHTML outerHTML等
    - DOM 中的内联事件监听器，如 `location`、`onclick`、`onerror`、`onload`、`onmouseover` 等，`<a>` 标签的 `href` 属性，JavaScript 的 `eval()`、`setTimeout()`、`setInterval()` 等，都能把字符串作为代码运行。如果不可信的数据拼接到字符串中传递给这些 API，很容易产生安全隐患，请务必避免。

  - 其他XSS防范措施

    虽然在渲染页面和执行 JavaScript 时，通过谨慎的转义可以防止 XSS 的发生，但完全依靠开发的谨慎仍然是不够的。以下介绍一些通用的方案，可以降低 XSS 带来的风险和后果。

#### XSS攻击的总结

#### XSS攻击的案列

