# 21 | 哈希算法（上）：如何防止数据库中的用户信息被脱库？

![img](https://static001.geekbang.org/resource/image/43/9b/432360759ea2e98eb287a006cce87a9b.jpg)

#### 在实际的开发中，我们该如何用哈希算法解决问题。

### 什么是哈希算法？

将任意长度的二进制值串映射为固定长度的二进制值串，这个映射的规则就是哈希算法，而通过原始数据映射之后得到的二进制值串就是哈希值。

##### 设计哈希算法的要求：

- 从哈希值不能反向推导出原始数据（所以哈希算法也叫单向哈希算法）；
- 对输入数据非常敏感，哪怕原始数据只修改了一个 Bit，最后得到的哈希值也大不相同；
- 散列冲突的概率要很小，对于不同的原始数据，哈希值相同的概率非常小；
- 哈希算法的执行效率要尽量高效，针对较长的文本，也能快速地计算出哈希值。

### 哈希算法的应用

- #### 安全加密

  - 算法：MD5，SHA，DES，AES。
  - 没有绝对安全的加密。越复杂、越难破解的加密算法，需要的计算时间也越长。

- #### 唯一标识

  - 思路
    - 任何文件在计算中都可以表示成二进制码串
    - 但完全对比二进制码串，不现实
    - 我们可以给每一个图片取一个唯一标识，或者说信息摘要。
    - 我们可以取部分，通过哈希算法，生成唯一标识。

- #### 数据校验

  - 如下载文件, p2p。
  - 哈希算法有一个特点，对数据很敏感。只要文件块的内容有一丁点儿的改变，最后计算出的哈希值就会完全不同。

- #### 散列函数

  - 散列函数中用到的散列算法，更加关注散列后的值是否能平均分布，也就是，一组数据是否能均匀地散列在各个槽中。
  - 散列函数执行的快慢，也会影响散列表的性能，所以，散列函数用的散列算法一般都比较简单，比较追求效率。

### 如何防止

- 哈希算法加密存储
- 字典攻击
  - 那我们就需要维护一个常用密码的字典表，把字典中的每个密码用哈希算法计算哈希值，然后拿哈希值跟脱库后的密文比对。
- 加盐(salt)
  - 跟用户的密码组合在一起，增加密码的复杂度。我们拿组合之后的字符串来做哈希算法加密，将它存储到数据库中，进一步增加破解的难度。

#### 安全和攻击是一种博弈关系，不存在绝对的安全。所有的安全措施，只是增加攻击的成本而已。