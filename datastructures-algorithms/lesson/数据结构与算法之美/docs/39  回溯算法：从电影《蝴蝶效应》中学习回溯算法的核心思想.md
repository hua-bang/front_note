# 39 | 回溯算法：从电影《蝴蝶效应》中学习回溯算法的核心思想

![img](https://static001.geekbang.org/resource/image/46/d7/468a82a391b8f24273561a6374c1ebd7.jpg)

回溯算法我们遇到的很多，比如DFS，数独、八皇后、0-1 背包、图的着色、旅行商问题、全排列等等。

### 如何理解“回溯算法”？

我们遇到岔路口的时候，我们有的选择，那我们应该怎么选择呢？

- 贪心算法：每次找最优的一条，但未必能达到最优解。
- 回溯：我们可以回到岔路重新做选择。（现实中并不存在）。

回溯的处理思想，有点类似枚举搜索。我们枚举所有的解，找到满足期望的解。为了有规律地枚举所有可能的解，避免遗漏和重复，我们把问题求解的过程分为多个阶段。

每个阶段，我们都会面临一个岔路口，我们选择一个路走，当走不通时，我们就回退到上一个岔路口，找另外的走法。

### 八皇后

题目：我们有一个 8x8 的棋盘，希望往里放 8 个棋子（皇后），每个棋子所在的行、列、对角线都不能有另一个棋子。你可以看我画的图，第一幅图是满足条件的一种方法，第二幅图是不满足条件的。八皇后问题就是期望找到所有满足这种要求的放棋子方式。

![img](https://static001.geekbang.org/resource/image/a0/f5/a0e3994319732ca77c81e0f92cc77ff5.jpg)

我们把这个问题划分成 8 个阶段，依次将 8 个棋子放到第一行、第二行、第三行……第八行。在放置的过程中，我们不停地检查当前放法，是否满足要求。如果满足，则跳到下一行继续放置棋子；如果不满足，那就再换一种放法，继续尝试。

回溯算法非常适合用递归代码实现。

#### 两个回溯算法的经典应用

1. ##### 0-1 背包

   解法：

   - 动态规划
   - 回溯
     - 穷举所有的结果，选最大。
     - 记得剪枝。

2. ##### 正则表达式

#### 内容小结

回溯算法的思想非常简单，大部分情况下，都是用来解决广义的搜索问题，也就是，从一组可能的解中，选择出一个满足要求的解。

回溯算法非常适合用递归来实现，在实现的过程中，剪枝操作是提高回溯效率的一种技巧。

利用剪枝，我们并不需要穷举搜索所有的情况，从而提高搜索效率。