# 30 | 图的表示：如何存储微博、微信等社交网络中的好友关系？

![img](https://static001.geekbang.org/resource/image/6c/ec/6c94ad5bc9c0402f53b6ced3d7e65fec.jpg)

如何存储微博、微信等这些社交网络的好友关系吗？

实际上，我们使用图便可以实现。

### 理解“图”

我们前面讲过了树这种非线性表数据结构，今天我们要讲另一种非线性表数据结构，图（Graph）。和树比起来，这是一种更加复杂的非线性表结构

图中：

- 元素称为**顶点**。
- 顶点之间的关系我们叫做**边**。
- 我们与顶点相连接的边的条数叫做**度**。
- 也分有向图和无向图，即标记了方向
  - 有向图中分入度和出度。
- **带权图**，每条边都有一个权重值。
  - ![img](https://static001.geekbang.org/resource/image/55/e8/55d7e4806dc47950ae098d959b03ace8.jpg)

### 内存中如何存放图这种数据结构呢

- ##### 邻接矩阵

  ![img](https://static001.geekbang.org/resource/image/62/d2/625e7493b5470e774b5aa91fb4fdb9d2.jpg)

  存储简单，但是浪费空间（遇到稀疏图的时候）。无向图也是。

  **优点**：简单、直接，方便计算处理

  **缺点**：遇到无向图或稀疏图会造成浪费。

- ##### 邻接表

  ![img](https://static001.geekbang.org/resource/image/03/94/039bc254b97bd11670cdc4bf2a8e1394.jpg)

  **优点**：节约了空间。

  **缺点**：加大了查询的开销。

#### 设计图

- 需求

  - 判断用户 A 是否关注了用户 B；
  - 判断用户 A 是否是用户 B 的粉丝；
  - 用户 A 关注用户 B；用户 A 取消关注用户 B；
  - 根据用户名称的首字母排序，分页获取用户的粉丝列表；
  - 根据用户名称的首字母排序，分页获取用户的关注列表。

- 如何存储

  - 使用有向图进行存储，这里使用邻接表

- 存在的问题

  - 如果体现某个用户被哪些用户关注了？

    - 需要逆邻接表
      - ![img](https://static001.geekbang.org/resource/image/50/a1/501440bcffdcf4e6f9a5ca1117e990a1.jpg)

  - 基础的邻接表不适合快速判断两个用户之间是否是关注与被关注的关系，所以我们选择改进版本，将邻接表中的链表改为支持快速查找的动态数据结构。选择哪种动态数据结构呢？红黑树、跳表、有序动态数组还是散列表呢？

    - 可以使用跳表。

  - 数据太多怎么办？

    ![img](https://static001.geekbang.org/resource/image/08/2f/08e4f4330a1d88e9fec94b0f2d1bbe2f.jpg)

### 内容小结

图的概念：

- 顶点
- 边
- 度（出度，入度）
- 有向图、无向图
- 权值、带权图

图的存储

- 邻接矩阵
  - 优点：高效查找
  - 缺点：可能会比较浪费空间
- 邻接表
  - 优点：节省空间
  - 缺点：查询效率低。